<!doctype html>
<html lang="lv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Valodas struktūras filtrs</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; line-height: 1.4; background:#fff; color:#111; }
    .wrap { max-width: 980px; margin: 0 auto; }
    textarea { width: 100%; min-height: 190px; padding: 12px; font-size: 16px; border-radius: 10px; border: 1px solid #ddd; }
    button { padding: 10px 14px; font-size: 15px; cursor: pointer; border-radius: 10px; border: 1px solid #ddd; background: #fff; }
    button:hover { background: #f7f7f7; }
    .row { display: flex; gap: 10px; align-items: center; margin: 12px 0; flex-wrap: wrap; }
    .card { border: 1px solid #e3e3e3; border-radius: 12px; padding: 16px; margin-top: 16px; background:#fafafa; }
    .muted { color: #666; font-size: 14px; }
    .pill { display: inline-block; padding: 2px 8px; border: 1px solid #ddd; border-radius: 999px; margin-left: 8px; font-size: 12px; color: #444; background: #fff; }
    .pillStrong { border-color: #bbb; background: #f1f1f1; }
    ul { margin: 8px 0 0 18px; }
    code { background: #f0f0f0; padding: 2px 6px; border-radius: 6px; }
    .sentence { padding: 12px; border-radius: 10px; border: 1px solid #e5e5e5; margin-top: 12px; background:#fff; }
    .sentenceHeader { display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; }
    .footer { margin-top: 40px; padding-top: 16px; border-top: 1px solid #eee; font-size: 13px; color:#666; }
    .toast { position: fixed; bottom: 16px; right: 16px; background: #111; color: #fff; padding: 10px 12px; border-radius: 10px; font-size: 13px; opacity: 0; transform: translateY(6px); transition: 180ms ease; pointer-events: none;}
    .toast.show { opacity: 0.92; transform: translateY(0); }
  </style>
</head>
<body>
<div class="wrap">

  <h1>Valodas struktūras filtrs</h1>

  <div class="card">
    <p>
      <strong>Valodas struktūras filtrs</strong> ir valodas analīzes rīks, kas
      <strong>kartē teikumu struktūru</strong>, nevis realitāti vai cilvēkus.
    </p>
    <p>
      Tas <strong>nenosaka patiesību</strong>, <strong>nedod padomus</strong>
      un <strong>nevērtē autoru</strong>.
      Rezultāts ir signāls par <em>valodas formu</em>,
      nevis spriedums par saturu.
    </p>
    <p class="muted">
      Viss notiek tikai tavā pārlūkā. Teksts netiek saglabāts un netiek nosūtīts uz serveri.
    </p>
  </div>

  <div class="card">
    <label for="input"><strong>Teksts analīzei</strong></label>
    <textarea id="input" placeholder="Ieraksti vai ielīmē tekstu..."></textarea>

    <div class="row">
      <button id="btnRun">Pārbaudīt</button>
      <button id="btnClear" type="button">Notīrīt</button>
      <button id="btnCopyText" type="button">Kopēt rezultātu</button>
      <button id="btnCopyJson" type="button">Kopēt JSON</button>
      <span class="muted">v0.3 · statisks · bez datu vākšanas</span>
    </div>
  </div>

  <div class="card">
    <strong>Rezultāts</strong>
    <div id="summary" class="muted" style="margin-top:8px;">Nav datu.</div>
    <div id="sentences"></div>
  </div>

  <div class="card">
    <strong>Ko rīks atzīmē</strong>
    <ul class="muted">
      <li><code>UNIVERSĀLIS</code> — absolūti vispārinājumi</li>
      <li><code>NORMATĪVS</code> — “vajag / jābūt” konstrukcijas</li>
      <li><code>CITU_IEKŠĒJAIS_STĀVOKLIS</code> — pieņēmumi par citu domām vai jūtām</li>
      <li><code>ABSTRAKTS_LABUMS</code> — neskaidri “labi / pareizi”</li>
      <li><code>RETROSPEKTĪVA_ETIĶETE</code> — identitāte kā cēlonis</li>
      <li><code>TELEOLOĢIJA</code> — iznākums bez mehānisma (“laiks rādīs”)</li>
    </ul>
  </div>

  <div class="footer">
    Valodas struktūras filtrs · v0.3 · statiska lapa · bez datu uzkrāšanas<br>
    Šis rīks nav terapija, koučings vai diagnoze.
  </div>

</div>

<div id="toast" class="toast">Kopēts</div>

<script>
<!doctype html>
<html lang="lv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fantāziju filtrs v0.3</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; line-height: 1.35; }
    .wrap { max-width: 980px; margin: 0 auto; }
    textarea { width: 100%; min-height: 190px; padding: 12px; font-size: 16px; border-radius: 10px; border: 1px solid #ddd; }
    button { padding: 10px 14px; font-size: 15px; cursor: pointer; border-radius: 10px; border: 1px solid #ddd; background: #fff; }
    button:hover { background: #f7f7f7; }
    .row { display: flex; gap: 10px; align-items: center; margin: 12px 0; flex-wrap: wrap; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 14px; margin-top: 14px; }
    .muted { color: #666; font-size: 14px; }
    .pill { display: inline-block; padding: 2px 8px; border: 1px solid #ddd; border-radius: 999px; margin-left: 8px; font-size: 12px; color: #444; background: #fafafa; }
    .pillStrong { border-color: #bbb; background: #f1f1f1; }
    ul { margin: 8px 0 0 18px; }
    code { background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 900px) { .grid { grid-template-columns: 1.25fr 0.75fr; } }
    .sentence { padding: 10px; border-radius: 10px; border: 1px solid #eee; margin-top: 10px; }
    .sentenceHeader { display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; }
    .toast { position: fixed; bottom: 16px; right: 16px; background: #111; color: #fff; padding: 10px 12px; border-radius: 10px; font-size: 13px; opacity: 0; transform: translateY(6px); transition: 180ms ease; pointer-events: none;}
    .toast.show { opacity: 0.92; transform: translateY(0); }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Fantāziju filtrs <span class="pill pillStrong">v0.3</span></h1>
    <p class="muted">Detektē acīmredzamus valodas marķierus. Nevērtē cilvēku. Nedod padomus.</p>

    <div class="grid">
      <div>
        <label for="input"><strong>Teksts</strong></label>
        <textarea id="input" placeholder="Ieraksti 1–5 teikumus..."></textarea>

        <div class="row">
          <button id="btnRun">Pārbaudīt</button>
          <button id="btnClear" type="button">Notīrīt</button>
          <button id="btnCopyText" type="button">Kopēt rezultātu (tekstu)</button>
          <button id="btnCopyJson" type="button">Kopēt JSON</button>
          <span class="muted">v0.3: + RETROSPEKTĪVA_ETIĶETE, + TELEOLOĢIJA</span>
        </div>

        <div class="card">
          <strong>Rezultāts</strong>
          <div id="summary" class="muted" style="margin-top:8px;">Nav datu.</div>
          <div id="sentences"></div>
        </div>
      </div>

      <div>
        <div class="card">
          <strong>Ko šis rīks meklē (v0.3)</strong>
          <ul class="muted">
            <li><code>UNIVERSĀLIS</code> (visi, vienmēr, nekad, neviens, katrs, jebkurš)</li>
            <li><code>NORMATĪVS</code> (vajag, vajadzētu, ir jādara, būtu jā, nedrīkst)</li>
            <li><code>CITU_IEKŠĒJAIS_STĀVOKLIS</code> (viņi/citi/cilvēki/kāds + domā/jūt/grib/saprot/zina)</li>
            <li><code>ABSTRAKTS_LABUMS</code> (labi, pareizi, taisnīgi, cilvēcīgi, normāli)</li>
            <li><code>RETROSPEKTĪVA_ETIĶETE</code> (es esmu/neesmu tāds; I am not the kind of person who…)</li>
            <li><code>TELEOLOĢIJA</code> (kad pienāks laiks; laiks rādīs; meant to be; everything happens for a reason…)</li>
          </ul>
        </div>

        <div class="card">
          <strong>Darbojas lokāli</strong>
          <p class="muted" style="margin-top:8px;">
            Saglabā kā <code>fantaziju-filtrs.html</code> un atver pārlūkā. Nekādu serveru.
          </p>
        </div>

        <div class="card">
          <strong>Piezīme</strong>
          <p class="muted" style="margin-top:8px;">
            Ja marķieri nav atrasti, tas nenozīmē “nav fantāzijas” — tikai šis filtrs neko neatrada.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">Kopēts</div>

<script>
(function () {
  // =========================
  // v0.3 vārdnīca (primitīva, deterministiska)
  // =========================

  const UNIVERSALS = ["visi","vienmēr","nekad","neviens","katrs","jebkurš"];
  const NORMATIVES = ["vajag","vajadzētu","nedrīkst"];
  const NORM_PATTERNS = [
    /\bir\s+jādara\b/gi,
    /\bbūtu\s+jā\b/gi
  ];
  const ABSTRACT_GOOD = ["labi","pareizi","taisnīgi","cilvēcīgi","normāli"];

  // CITU_IEKŠĒJAIS_STĀVOKLIS: (viņi|citi|cilvēki|kāds) + (domā|jūt|grib|saprot|zina)
  const OTHERS_STATE = /\b(viņi|citi|cilvēki|kāds)\b\s+\b(domā|jūt|grib|saprot|zina)\b/gi;

  // RETROSPEKTĪVA_ETIĶETE (v0.2)
  const RETRO_LABEL_PATTERNS = [
    // LV
    /\bes\s+neesmu\s+tāds\b/gi,
    /\bes\s+esmu\s+tāds\b/gi,
    /\bes\s+neesmu\s+cilvēks,\s*kas\b/gi,
    /\bes\s+neesmu\s+no\s+tiem,\s*kas\b/gi,
    /\btāds\s+cilvēks\s+kā\s+es\b/gi,

    // EN
    /\bi\s+am\s+not\s+the\s+kind\s+of\s+person\s+who\b/gi,
    /\bi\s+am\s+the\s+type\s+of\s+person\s+who\b/gi,
    /\bi['’]m\s+just\s+not\s+someone\s+who\b/gi
  ];

  // TELEOLOĢIJA (v0.3)
  const TELEOLOGY_PATTERNS = [
    // LV — laiks / automātisms
    /\bkad\s+pienāks\s+laiks\b/gi,
    /\bar\s+laiku\b/gi,
    /\blaiks\s+rādīs\b/gi,
    /\bdzīve\s+parādīs\b/gi,
    /\bviss\s+nāks\s+pats\b/gi,

    // LV — noliktība
    /\btā\s+bija\s+lemts\b/gi,
    /\btam\s+bija\s+jānotiek\b/gi,
    /\btā\s+tam\s+jābūt\b/gi,
    /\bliktenis\b/gi,
    /\bparedzēts\b/gi,

    // LV — saprašana bez mehānisma
    /\btad\s+sapratīšu\b/gi,
    /\bkaut\s+kad\s+sapratīšu\b/gi,
    /\bpats\s+kļūs\s+skaidrs\b/gi,

    // EN
    /\bwhen\s+the\s+time\s+comes\b/gi,
    /\bin\s+time\b/gi,
    /\btime\s+will\s+tell\b/gi,
    /\bmeant\s+to\s+be\b/gi,
    /\bdestiny\b/gi,
    /\blife\s+will\s+show\b/gi,
    /\beverything\s+happens\s+for\s+a\s+reason\b/gi
  ];

  // =========================
  // UI state
  // =========================
  let lastResult = null;

  function escapeHtml(s) {
    return String(s).replace(/[&<>"']/g, (c) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  function toast(msg) {
    const el = document.getElementById("toast");
    el.textContent = msg || "Gatavs";
    el.classList.add("show");
    window.setTimeout(() => el.classList.remove("show"), 1200);
  }

  // Vienkāršs teikumu dalītājs (v0.1.x) — pietiek prototipam
  function splitSentences(text) {
    const raw = text
      .replace(/\r\n/g, "\n")
      .split(/\n+/)
      .map(s => s.trim())
      .filter(Boolean);

    const out = [];
    for (const chunk of raw) {
      const parts = chunk.split(/([.!?;]+)\s+/);
      if (parts.length === 1) { out.push(chunk); continue; }
      let buf = "";
      for (let i = 0; i < parts.length; i++) {
        const p = parts[i];
        if (!p) continue;
        buf += p;
        if (/[.!?;]+/.test(p)) {
          out.push(buf.trim());
          buf = "";
        } else {
          buf += " ";
        }
      }
      if (buf.trim()) out.push(buf.trim());
    }
    return out;
  }

  function findWordMarkers(textLower, words, type) {
    const markers = [];
    for (const w of words) {
      const re = new RegExp(`\\b${w}\\b`, "gi");
      let m;
      while ((m = re.exec(textLower)) !== null) {
        markers.push({ text: m[0], type, index: m.index });
      }
    }
    return markers;
  }

  function findRegexMarkers(text, regex, type) {
    const markers = [];
    let m;
    const re = new RegExp(regex.source, regex.flags); // clone
    while ((m = re.exec(text)) !== null) {
      markers.push({ text: m[0], type, index: m.index });
    }
    return markers;
  }

  function analyzeSentence(sentenceText) {
    const original = sentenceText.trim();
    const lower = original.toLowerCase();

    let markers = [];

    // v0.1.x tipi
    markers = markers.concat(findWordMarkers(lower, UNIVERSALS, "UNIVERSĀLIS"));
    markers = markers.concat(findWordMarkers(lower, NORMATIVES, "NORMATĪVS"));
    markers = markers.concat(findWordMarkers(lower, ABSTRACT_GOOD, "ABSTRAKTS_LABUMS"));
    for (const p of NORM_PATTERNS) markers = markers.concat(findRegexMarkers(original, p, "NORMATĪVS"));
    markers = markers.concat(findRegexMarkers(original, OTHERS_STATE, "CITU_IEKŠĒJAIS_STĀVOKLIS"));

    // v0.2: retrospektīva etiķete
    for (const p of RETRO_LABEL_PATTERNS) {
      markers = markers.concat(findRegexMarkers(original, p, "RETROSPEKTĪVA_ETIĶETE"));
    }

    // v0.3: teleoloģija
    for (const p of TELEOLOGY_PATTERNS) {
      markers = markers.concat(findRegexMarkers(original, p, "TELEOLOĢIJA"));
    }

    markers.sort((a,b) => a.index - b.index);

    return {
      text: original,
      markers: markers.map(({text, type}) => ({ text, type })),
      nf: markers.length
    };
  }

  function analyze(input) {
    const text = (input || "").trim();
    if (!text) {
      return { input:"", language:"lv", sentences: [], nf_total: 0, nf_average: 0, disclaimer: "Kartēta valoda, nevis novērtēts cilvēks." };
    }

    const sentenceList = splitSentences(text);
    const analyzed = sentenceList.map(analyzeSentence);

    const nf_total = analyzed.reduce((sum, s) => sum + s.nf, 0);
    const nf_average = analyzed.length ? (nf_total / analyzed.length) : 0;

    return {
      input: text,
      language: "lv",
      sentences: analyzed.map((s, idx) => ({ id: idx + 1, ...s })),
      nf_total,
      nf_average: Number(nf_average.toFixed(2)),
      disclaimer: "Kartēta valoda, nevis novērtēts cilvēks."
    };
  }

  function render(result) {
    const summaryEl = document.getElementById("summary");
    const sentencesEl = document.getElementById("sentences");

    lastResult = result;

    if (!result.input) {
      summaryEl.textContent = "Nav datu.";
      sentencesEl.innerHTML = "";
      return;
    }

    summaryEl.innerHTML =
      `Teikumi: <strong>${result.sentences.length}</strong> · ` +
      `NF kopā: <strong>${result.nf_total}</strong> · ` +
      `NF vidēji: <strong>${result.nf_average}</strong> ` +
      `<span class="muted">(NF = atrasto marķieru skaits)</span>`;

    sentencesEl.innerHTML = result.sentences.map(s => {
      const markerHtml = (s.markers && s.markers.length)
        ? `<ul>${s.markers.map(m => `<li><code>${escapeHtml(m.text)}</code> <span class="pill">${escapeHtml(m.type)}</span></li>`).join("")}</ul>`
        : `<p class="muted" style="margin:8px 0 0 0;">Marķieri nav atrasti (v0.3).</p>`;

      return `
        <div class="sentence">
          <div class="sentenceHeader">
            <div><strong>#${s.id}</strong> <span class="muted">${escapeHtml(s.text)}</span></div>
            <div><span class="pill pillStrong">NF ${s.nf}</span></div>
          </div>
          ${markerHtml}
        </div>
      `;
    }).join("");
  }

  async function copyToClipboard(text, okMsg) {
    try {
      await navigator.clipboard.writeText(text);
      toast(okMsg || "Kopēts");
    } catch (e) {
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      toast(okMsg || "Kopēts");
    }
  }

  document.getElementById("btnRun").addEventListener("click", () => {
    const input = document.getElementById("input").value;
    render(analyze(input));
  });

  document.getElementById("btnClear").addEventListener("click", () => {
    document.getElementById("input").value = "";
    render({ input:"", language:"lv", sentences: [], nf_total: 0, nf_average: 0, disclaimer: "Kartēta valoda, nevis novērtēts cilvēks." });
    toast("Notīrīts");
  });

  document.getElementById("btnCopyJson").addEventListener("click", () => {
    const payload = lastResult || analyze(document.getElementById("input").value);
    copyToClipboard(JSON.stringify(payload, null, 2), "JSON nokopēts");
  });

  document.getElementById("btnCopyText").addEventListener("click", () => {
    const payload = lastResult || analyze(document.getElementById("input").value);
    if (!payload.input) return toast("Nav ko kopēt");
    const lines = [];
    lines.push("Fantāziju filtrs v0.3");
    lines.push(`Teikumi: ${payload.sentences.length}`);
    lines.push(`NF kopā: ${payload.nf_total} · NF vidēji: ${payload.nf_average}`);
    lines.push("");
    for (const s of payload.sentences) {
      lines.push(`#${s.id} (NF ${s.nf}) ${s.text}`);
      if (s.markers.length) {
        for (const m of s.markers) lines.push(`- ${m.text} [${m.type}]`);
      } else {
        lines.push("- (nav marķieru v0.3)");
      }
      lines.push("");
    }
    copyToClipboard(lines.join("\n"), "Rezultāts nokopēts");
  });

  // Demo teksts startā (lai uzreiz redz, ka strādā)
  const demo = [
    "Katram būtu jāuzņemas atbildība.",
    "Kad pienāks laiks, tad sapratīšu.",
    "Ar laiku viss kļūs skaidrs.",
    "Es neesmu tāds, kas var pateikt šādas frāzes.",
    "Everybody is awesome.",
    "Everything happens for a reason."
  ].join("\n");
  document.getElementById("input").value = demo;
  render(analyze(demo));
})();
</script>
</body>
</html>
</script>

</body>
</html>
